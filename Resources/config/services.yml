parameters:
    # Entities
    orocrm_mailchimp.entity.campaign.class: OroCRM\Bundle\MailChimpBundle\Entity\Campaign
    orocrm_mailchimp.entity.template.class: OroCRM\Bundle\MailChimpBundle\Entity\Template
    orocrm_mailchimp.entity.subscribers_list.class: OroCRM\Bundle\MailChimpBundle\Entity\SubscribersList
    orocrm_mailchimp.entity.member.class: OroCRM\Bundle\MailChimpBundle\Entity\Member
    orocrm_mailchimp.entity.member_activity.class: OroCRM\Bundle\MailChimpBundle\Entity\MemberActivity
    orocrm_mailchimp.entity.static_segment.class: OroCRM\Bundle\MailChimpBundle\Entity\StaticSegment
    orocrm_mailchimp.entity.static_segment_member.class: OroCRM\Bundle\MailChimpBundle\Entity\StaticSegmentMember

    orocrm_mailchimp.transport.mailchimp.class: OroCRM\Bundle\MailChimpBundle\Transport\MailChimpTransport
    orocrm_mailchimp.model.field_helper.class: OroCRM\Bundle\MailChimpBundle\Model\FieldHelper
    orocrm_mailchimp.validator.email_column.class: OroCRM\Bundle\MailChimpBundle\Validator\EmailColumnValidator
    orocrm_mailchimp.placeholder.filter.buttons_filder.class: OroCRM\Bundle\MailChimpBundle\Placeholder\ButtonsPlaceholderFilter

    # Forms and extensions
    orocrm_mailchimp.form.extension.channel_connectors.class: OroCRM\Bundle\MailChimpBundle\Form\Extension\ChannelConnectorsExtension
    orocrm_mailchimp.form.type.integration_transport_settings.class: OroCRM\Bundle\MailChimpBundle\Form\Type\IntegrationSettingsType
    orocrm_mailchimp.form.type.integration_select.class: OroCRM\Bundle\MailChimpBundle\Form\Type\MailChimpIntegrationSelectType
    orocrm_mailchimp.form.type.template_select.class: OroCRM\Bundle\MailChimpBundle\Form\Type\MailchimpTemplateSelectType
    orocrm_mailchimp.form.type.list_select.class: OroCRM\Bundle\MailChimpBundle\Form\Type\MailchimpListSelectType
    orocrm_mailchimp.form.type.transport_settings.class: OroCRM\Bundle\MailChimpBundle\Form\Type\MailChimpTransportSettingsType
    orocrm_mailchimp.form.type.api_key_type.class: OroCRM\Bundle\MailChimpBundle\Form\Type\ApiKeyType
    orocrm_mailchimp.form.type.marketing_list_connecion.class: OroCRM\Bundle\MailChimpBundle\Form\Type\MarketingListConnectionType
    orocrm_mailchimp.form.autocomplete.template.search_handler.class: OroCRM\Bundle\MailChimpBundle\Autocomplete\TemplateSearchHandler
    orocrm_mailchimp.form.autocomplete.list.search_handler.class: OroCRM\Bundle\MailChimpBundle\Autocomplete\ListSearchHandler
    orocrm_mailchimp.form.handler.connection_form.class: OroCRM\Bundle\MailChimpBundle\Form\Handler\ConnectionFormHandler
    orocrm_mailchimp.static_segment.manager.api.class: Oro\Bundle\SoapBundle\Entity\Manager\ApiEntityManager

    # Integration related services
    orocrm_mailchimp.transport.integration_transport.class: OroCRM\Bundle\MailChimpBundle\Provider\Transport\MailChimpTransport
    orocrm_mailchimp.provider.channel_type.class: OroCRM\Bundle\MailChimpBundle\Provider\ChannelType
    orocrm_mailchimp.client.class: OroCRM\Bundle\MailChimpBundle\Provider\Transport\MailChimpClient
    orocrm_mailchimp.client.factory.class: OroCRM\Bundle\MailChimpBundle\Provider\Transport\MailChimpClientFactory

    # Readers
    orocrm_mailchimp.importexport.reader.processed_entities.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Reader\ProcessedEntities
    orocrm_mailchimp.importexport.reader.static_segment.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Reader\StaticSegmentReader
    orocrm_mailchimp.importexport.reader.iterator_based.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Reader\AbstractIteratorBasedReader
    orocrm_mailchimp.importexport.reader.member_export.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Reader\MemberExportReader
    orocrm_mailchimp.importexport.reader.static_segment_export.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Reader\StaticSegmentExportReader
    orocrm_mailchimp.importexport.reader.unsent_activities.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Reader\UnsentActivitiesReader

    # Writers
    orocrm_mailchimp.importexport.writer.remove.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Writer\RemoveWriter
    orocrm_mailchimp.importexport.writer.member.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Writer\MemberWriter
    orocrm_mailchimp.importexport.writer.static_segment.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Writer\StaticSegmentExportWriter

    # Serializers
    orocrm_mailchimp.importexport.serializer.datetime.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Serializer\DateTimeSerializer

    # Strategies
    orocrm_mailchimp.importexport.strategy.campaign.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Strategy\CampaignImportStrategy
    orocrm_mailchimp.importexport.strategy.template.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Strategy\TemplateImportStrategy
    orocrm_mailchimp.importexport.strategy.list.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Strategy\ListImportStrategy
    orocrm_mailchimp.importexport.strategy.member.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Strategy\MemberImportStrategy
    orocrm_mailchimp.importexport.strategy.member_activity.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Strategy\MemberActivityImportStrategy
    orocrm_mailchimp.importexport.strategy.unsent_activity.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Strategy\UnsentActivityStrategy
    orocrm_mailchimp.importexport.strategy.static_segment.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Strategy\StaticSegmentImportStrategy

    # Connectors
    orocrm_mailchimp.connector.template.class: OroCRM\Bundle\MailChimpBundle\Provider\Connector\TemplateConnector
    orocrm_mailchimp.connector.list.class: OroCRM\Bundle\MailChimpBundle\Provider\Connector\ListConnector
    orocrm_mailchimp.connector.member.class: OroCRM\Bundle\MailChimpBundle\Provider\Connector\MemberConnector
    orocrm_mailchimp.connector.member_activity.class: OroCRM\Bundle\MailChimpBundle\Provider\Connector\MemberActivityConnector
    orocrm_mailchimp.connector.static_segment.class: OroCRM\Bundle\MailChimpBundle\Provider\Connector\StaticSegmentConnector
    orocrm_mailchimp.connector.campaign.class: OroCRM\Bundle\MailChimpBundle\Provider\Connector\CampaignConnector

    # Data Converter
    orocrm_mailchimp.importexport.data_converter.template.class: OroCRM\Bundle\MailChimpBundle\ImportExport\DataConverter\TemplateDataConverter
    orocrm_mailchimp.importexport.data_converter.list.class: OroCRM\Bundle\MailChimpBundle\ImportExport\DataConverter\ListDataConverter
    orocrm_mailchimp.importexport.data_converter.member.class: OroCRM\Bundle\MailChimpBundle\ImportExport\DataConverter\MemberDataConverter
    orocrm_mailchimp.importexport.data_converter.member_sync.class: OroCRM\Bundle\MailChimpBundle\ImportExport\DataConverter\MemberSyncDataConverter
    orocrm_mailchimp.importexport.data_converter.member_activity.class: OroCRM\Bundle\MailChimpBundle\ImportExport\DataConverter\MemberActivityDataConverter
    orocrm_mailchimp.importexport.data_converter.unsent_activity.class: OroCRM\Bundle\MailChimpBundle\ImportExport\DataConverter\UnsentActivityDataConverter
    orocrm_mailchimp.importexport.data_converter.campaign.class: OroCRM\Bundle\MailChimpBundle\ImportExport\DataConverter\CampaignDataConverter
    orocrm_mailchimp.importexport.data_converter.static_segment.class: OroCRM\Bundle\MailChimpBundle\ImportExport\DataConverter\StaticSegmentDataConverter
    orocrm_mailchimp.importexport.data_converter.static_segment_member.class: OroCRM\Bundle\MailChimpBundle\ImportExport\DataConverter\StaticSegmentMemberDataConverter

    # Import Processors
    orocrm_mailchimp.importexport.processor.import.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Processor\ImportProcessor
    orocrm_mailchimp.importexport.processor.remove.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Processor\RemoveProcessor

    # Export Processors
    orocrm_mailchimp.importexport.processor.export_member.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Processor\ExportProcessor
    orocrm_mailchimp.importexport.processor.export_static_segment.class: OroCRM\Bundle\MailChimpBundle\ImportExport\Processor\ExportProcessor

    # MergeVar related services
    orocrm_mailchimp.merge_var.provider.class: OroCRM\Bundle\MailChimpBundle\Model\MergeVar\MergeVarProvider

    # Service for locking processes
    orocrm_mailchimp.lock.class: OroCRM\Bundle\MailChimpBundle\Model\Lock\Lock

    # Workflow actions and conditions
    orocrm_mailchimp.workflow.condition.is_locked.class: OroCRM\Bundle\MailChimpBundle\Model\Condition\IsLocked
    orocrm_mailchimp.workflow.action.lock.class: OroCRM\Bundle\MailChimpBundle\Model\Action\Lock
    orocrm_mailchimp.workflow.action.unlock.class: OroCRM\Bundle\MailChimpBundle\Model\Action\Unlock
    orocrm_mailchimp.workflow.action.remove_entity.class: OroCRM\Bundle\MailChimpBundle\Model\Action\RemoveEntity
    orocrm_mailchimp.workflow.action.populate_integration_owner.class: OroCRM\Bundle\MailChimpBundle\Model\Action\PopulateIntegrationOwner
    orocrm_mailchimp.workflow.action.assign_constant_value.class: OroCRM\Bundle\MailChimpBundle\Model\Action\AssignConstantValue
    orocrm_mailchimp.workflow.action.update_email_campaign_statistics.class: OroCRM\Bundle\MailChimpBundle\Model\Action\UpdateEmailCampaignStatistics
    orocrm_mailchimp.workflow.action.abstract_marketing_list_entities.class: OroCRM\Bundle\MailChimpBundle\Model\Action\AbstractMarketingListEntitiesAction
    orocrm_mailchimp.workflow.action.create_marketing_list_state_item.class: OroCRM\Bundle\MailChimpBundle\Model\Action\MarketingListStateItemAction

    # EmailCampaign Voter
    orocrm_mailchimp.email_campaign.security.acl.voter.entity.class: OroCRM\Bundle\MailChimpBundle\Acl\Voter\EmailCampaignVoter

    orocrm_mailchimp.static_segment_manager.state_manager.class: OroCRM\Bundle\MailChimpBundle\Model\StaticSegment\StaticSegmentsMemberStateManager
    
    # Placeholder filter
    orocrm_mailchimp.placeholder.filter.email_campaign.class: OroCRM\Bundle\MailChimpBundle\Placeholder\EmailCampaignPlaceholderFilter

    orocrm_mailchimp.static_segment_manager.state_mamanger.class: OroCRM\Bundle\MailChimpBundle\Model\StaticSegment\StaticSegmentsMemberStateManager

    # Iterators
    orocrm_mailchimp.iterator.static_segment.class: OroCRM\Bundle\MailChimpBundle\Provider\Transport\Iterator\AbstractStaticSegmentIterator
    orocrm_mailchimp.iterator.member_sync.class: OroCRM\Bundle\MailChimpBundle\Provider\Transport\Iterator\MemberSyncIterator
    orocrm_mailchimp.iterator.static_segment_member_add_state.class: OroCRM\Bundle\MailChimpBundle\Provider\Transport\Iterator\StaticSegmentMemberAddStateIterator
    orocrm_mailchimp.iterator.static_segment_member_remove_state.class: OroCRM\Bundle\MailChimpBundle\Provider\Transport\Iterator\StaticSegmentMemberRemoveStateIterator

services:
    orocrm_mailchimp.client.factory:
        class: %orocrm_mailchimp.client.factory.class%
        arguments:
            - %orocrm_mailchimp.client.class%

    orocrm_mailchimp.transport.mailchimp:
        class: %orocrm_mailchimp.transport.mailchimp.class%
        tags:
            - { name: "orocrm_campaign.email_transport" }

    orocrm_mailchimp.model.field_helper:
        class: %orocrm_mailchimp.model.field_helper.class%
        arguments:
            - @oro_entity.virtual_field_provider

    orocrm_mailchimp.validator.email_column:
        class: %orocrm_mailchimp.validator.email_column.class%
        arguments:
            - @orocrm_marketing_list.contact_information_column_validator
            - @doctrine
        tags:
            - { name: validator.constraint_validator, alias: orocrm_mailchimp.validator.email_column }

    orocrm_mailchimp.placeholder.filter.buttons_filder:
        class: %orocrm_mailchimp.placeholder.filter.buttons_filder.class%
        arguments:
            - @orocrm_marketing_list.provider.contact_information_fields

    orocrm_mailchimp.static_segment.manager.api:
        parent: oro_soap.manager.entity_manager.abstract
        class: %orocrm_mailchimp.static_segment.manager.api.class%
        arguments:
            - %orocrm_mailchimp.entity.static_segment.class%
            - @doctrine.orm.entity_manager

    # Readers
    orocrm_mailchimp.importexport.reader.processed_entities:
        class: %orocrm_mailchimp.importexport.reader.processed_entities.class%
        arguments:
            - @oro_importexport.context_registry

    orocrm_mailchimp.importexport.reader.static_segment:
        class: %orocrm_mailchimp.importexport.reader.static_segment.class%
        arguments:
            - @oro_importexport.context_registry
            - @oro_entity.doctrine_helper
            - %orocrm_marketing_list.entity.class%
            - %orocrm_mailchimp.entity.static_segment.class%

    orocrm_mailchimp.importexport.reader.members_sync:
        parent: orocrm_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, [@orocrm_mailchimp.iterator.member_sync]]

    orocrm_mailchimp.importexport.reader.static_segment_member_add_state:
        parent: orocrm_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, [@orocrm_mailchimp.iterator.static_segment_member_add_state]]

    orocrm_mailchimp.importexport.reader.static_segment_member_remove_state:
        parent: orocrm_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, [@orocrm_mailchimp.iterator.static_segment_member_remove_state]]

    orocrm_mailchimp.importexport.reader.abstract_iterator_based:
        class: %orocrm_mailchimp.importexport.reader.iterator_based.class%
        abstract: true
        arguments:
            - @oro_importexport.context_registry
            - @oro_entity.doctrine_helper

    orocrm_mailchimp.importexport.reader.member_export:
        class: %orocrm_mailchimp.importexport.reader.member_export.class%
        parent: orocrm_mailchimp.importexport.reader.abstract_iterator_based
        calls:
            - [setMemberClassName, [%orocrm_mailchimp.entity.member.class%]]
            - [setSubscribersListClassName, [%orocrm_mailchimp.entity.subscribers_list.class%]]

    orocrm_mailchimp.importexport.reader.static_segment_export:
        class: %orocrm_mailchimp.importexport.reader.static_segment_export.class%
        parent: orocrm_mailchimp.importexport.reader.abstract_iterator_based
        calls:
            - [setStaticSegmentClassName, [%orocrm_mailchimp.entity.static_segment.class%]]
            - [setStaticSegmentMemberClassName, [%orocrm_mailchimp.entity.static_segment_member.class%]]

    orocrm_mailchimp.importexport.reader.unsent_activities:
        class: %orocrm_mailchimp.importexport.reader.unsent_activities.class%
        arguments:
            - @oro_importexport.context_registry
        calls:
            - [setRegistry, [@doctrine]]

    # Writers
    orocrm_mailchimp.importexport.writer.template.remove:
        class: %orocrm_mailchimp.importexport.writer.remove.class%
        arguments:
            - @doctrine
            - %orocrm_mailchimp.entity.template.class%
            - 'originId'

    orocrm_mailchimp.importexport.writer.list.remove:
        class: %orocrm_mailchimp.importexport.writer.remove.class%
        arguments:
            - @doctrine
            - %orocrm_mailchimp.entity.subscribers_list.class%
            - 'originId'

    orocrm_mailchimp.importexport.writer.campaign.remove:
        class: %orocrm_mailchimp.importexport.writer.remove.class%
        arguments:
            - @doctrine
            - %orocrm_mailchimp.entity.campaign.class%
            - 'originId'

    orocrm_mailchimp.importexport.writer.abstract_export:
        abstract: true
        parent: oro_integration.writer.persistent_batch_writer
        calls:
            - [setTransport, [@orocrm_mailchimp.transport.integration_transport]]

    orocrm_mailchimp.importexport.writer.member:
        class: %orocrm_mailchimp.importexport.writer.member.class%
        parent: orocrm_mailchimp.importexport.writer.abstract_export
        calls:
            - [setLogger, [@oro_integration.logger.strategy]]

    orocrm_mailchimp.importexport.writer.static_segment:
        class: %orocrm_mailchimp.importexport.writer.static_segment.class%
        parent: orocrm_mailchimp.importexport.writer.abstract_export

    #Serializers
    orocrm_mailchimp.importexport.serializer.datetime:
        class: %orocrm_mailchimp.importexport.serializer.datetime.class%
        tags:
            - { name: oro_importexport.normalizer }

    # Forms and extensions
    orocrm_mailchimp.form.extension.channel_connectors:
        class: %orocrm_mailchimp.form.extension.channel_connectors.class%
        tags:
            - { name: form.type_extension, alias: oro_integration_channel_form }

    orocrm_mailchimp.form.type.api_key_type:
        class: %orocrm_mailchimp.form.type.api_key_type.class%
        tags:
            - { name: form.type, alias: "orocrm_mailchimp_api_key_type" }

    orocrm_mailchimp.form.type.integration_transport_settings:
        class: %orocrm_mailchimp.form.type.integration_transport_settings.class%
        tags:
            - { name: form.type, alias: "orocrm_mailchimp_integration_transport_setting_type" }

    orocrm_mailchimp.form.type.integration_select:
        class: %orocrm_mailchimp.form.type.integration_select.class%
        arguments:
            - @doctrine
            - @oro_security.acl_helper
        tags:
            - { name: form.type, alias: "orocrm_mailchimp_integration_select" }

    orocrm_mailchimp.form.type.template_select:
        class: %orocrm_mailchimp.form.type.template_select.class%
        tags:
            - { name: form.type, alias: "orocrm_mailchimp_template_select" }

    orocrm_mailchimp.form.type.list_select:
        class: %orocrm_mailchimp.form.type.list_select.class%
        tags:
            - { name: form.type, alias: "orocrm_mailchimp_list_select" }

    orocrm_mailchimp.form.type.transport_settings:
        class: %orocrm_mailchimp.form.type.transport_settings.class%
        tags:
            - { name: form.type, alias: "orocrm_mailchimp_email_transport_settings" }

    orocrm_mailchimp.form.type.marketing_list_connecion:
        class: %orocrm_mailchimp.form.type.marketing_list_connecion.class%
        tags:
            - { name: form.type, alias: "orocrm_mailchimp_marketing_list_connection" }

    orocrm_mailchimp.form.marketing_list_connecion:
        class: Symfony\Component\Form\Form
        factory_method: createNamed
        factory_service: form.factory
        arguments: ["orocrm_mailchimp_marketing_list_connection_form", "orocrm_mailchimp_marketing_list_connection", null]

    orocrm_mailchimp.form.autocomplete.template.search_handler:
        class: %orocrm_mailchimp.form.autocomplete.template.search_handler.class%
        arguments:
            - %orocrm_mailchimp.entity.template.class%
            - ["name"]
        calls:
            - [initDoctrinePropertiesByManagerRegistry, [@doctrine]]
            - [setAclHelper,["@oro_security.acl_helper"]]
        tags:
            - { name: oro_form.autocomplete.search_handler, alias: "mailchimp_templates", acl_resource: "orocrm_email_campaign_view" }

    orocrm_mailchimp.form.autocomplete.list.search_handler:
        class: %orocrm_mailchimp.form.autocomplete.list.search_handler.class%
        arguments:
            - %orocrm_mailchimp.entity.subscribers_list.class%
            - ["name"]
        calls:
            - [initDoctrinePropertiesByManagerRegistry, ["@doctrine"]]
            - [setAclHelper,["@oro_security.acl_helper"]]
        tags:
            - { name: oro_form.autocomplete.search_handler, alias: "mailchimp_lists", acl_resource: "orocrm_email_campaign_view" }

    orocrm_mailchimp.form.handler.connection_form:
        parent: oro_form.form_handler.api
        class: %orocrm_mailchimp.form.handler.connection_form.class%
        scope: request
        calls:
            - [setForm, [@orocrm_mailchimp.form.marketing_list_connecion]]

    # Integration related services
    orocrm_mailchimp.provider.channel_type:
            class: %orocrm_mailchimp.provider.channel_type.class%
            tags:
                - { name: oro_integration.channel, type: mailchimp }

    orocrm_mailchimp.transport.integration_transport:
        class: %orocrm_mailchimp.transport.integration_transport.class%
        arguments:
            - @orocrm_mailchimp.client.factory
            - @doctrine
        tags:
            - { name: oro_integration.transport, type: mailchimp_api, channel_type: mailchimp }

    # Connectors
    orocrm_mailchimp.connector.abstract:
        abstract: true
        arguments:
            - @oro_importexport.context_registry
            - @oro_integration.logger.strategy
            - @oro_integration.provider.connector_context_mediator
        calls:
            - [setManagerRegistry, [@doctrine]]

    orocrm_mailchimp.connector.template:
        class: %orocrm_mailchimp.connector.template.class%
        parent: orocrm_mailchimp.connector.abstract
        calls:
            - [setEntityName, [%orocrm_mailchimp.entity.template.class%]]
#        tags:
#            - { name: oro_integration.connector, type: template, channel_type: mailchimp }

    orocrm_mailchimp.connector.list:
        class: %orocrm_mailchimp.connector.list.class%
        parent: orocrm_mailchimp.connector.abstract
        calls:
            - [setEntityName, [%orocrm_mailchimp.entity.subscribers_list.class%]]
        tags:
            - { name: oro_integration.connector, type: list, channel_type: mailchimp }

    orocrm_mailchimp.connector.campaign:
        class: %orocrm_mailchimp.connector.campaign.class%
        parent: orocrm_mailchimp.connector.abstract
        calls:
            - [setEntityName, [%orocrm_mailchimp.entity.campaign.class%]]
        tags:
            - { name: oro_integration.connector, type: campaign, channel_type: mailchimp }

    orocrm_mailchimp.connector.static_segment:
        class: %orocrm_mailchimp.connector.static_segment.class%
        parent: orocrm_mailchimp.connector.abstract
        calls:
            - [setEntityName, [%orocrm_mailchimp.entity.static_segment.class%]]
        tags:
            - { name: oro_integration.connector, type: static_segment, channel_type: mailchimp }

    orocrm_mailchimp.connector.member:
        class: %orocrm_mailchimp.connector.member.class%
        parent: orocrm_mailchimp.connector.abstract
        calls:
            - [setEntityName, [%orocrm_mailchimp.entity.member.class%]]
        tags:
            - { name: oro_integration.connector, type: member, channel_type: mailchimp }

    orocrm_mailchimp.connector.member_activity:
        class: %orocrm_mailchimp.connector.member_activity.class%
        parent: orocrm_mailchimp.connector.abstract
        calls:
            - [setEntityName, [%orocrm_mailchimp.entity.member_activity.class%]]
        tags:
            - { name: oro_integration.connector, type: member_activity, channel_type: mailchimp }

    # Data Converter
    orocrm_mailchimp.importexport.data_converter.campaign:
        class: %orocrm_mailchimp.importexport.data_converter.campaign.class%

    orocrm_mailchimp.importexport.data_converter.template:
        class: %orocrm_mailchimp.importexport.data_converter.template.class%

    orocrm_mailchimp.importexport.data_converter.list:
        class: %orocrm_mailchimp.importexport.data_converter.list.class%

    orocrm_mailchimp.importexport.data_converter.member:
        class: %orocrm_mailchimp.importexport.data_converter.member.class%

    orocrm_mailchimp.importexport.data_converter.member_activity:
        class: %orocrm_mailchimp.importexport.data_converter.member_activity.class%

    orocrm_mailchimp.importexport.data_converter.unsent_activity:
        class: %orocrm_mailchimp.importexport.data_converter.unsent_activity.class%

    orocrm_mailchimp.importexport.data_converter.member_sync:
        class: %orocrm_mailchimp.importexport.data_converter.member_sync.class%
        calls:
            - [setContactInformationFieldsProvider, [@orocrm_marketing_list.provider.contact_information_fields]]
            - [setMemberClassName, [%orocrm_mailchimp.entity.member.class%]]

    orocrm_mailchimp.importexport.data_converter.static_segment:
        class: %orocrm_mailchimp.importexport.data_converter.static_segment.class%

    orocrm_mailchimp.importexport.data_converter.static_segment_member:
        class: %orocrm_mailchimp.importexport.data_converter.static_segment_member.class%

    # Strategy
    orocrm_mailchimp.importexport.strategy.template.add_or_replace:
        class: %orocrm_mailchimp.importexport.strategy.template.class%
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setLogger, [@oro_integration.logger.strategy]]

    orocrm_mailchimp.importexport.strategy.list:
        class: %orocrm_mailchimp.importexport.strategy.list.class%
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setLogger, [@oro_integration.logger.strategy]]

    orocrm_mailchimp.importexport.strategy.member:
        class: %orocrm_mailchimp.importexport.strategy.member.class%
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setLogger, [@oro_integration.logger.strategy]]
            - [setMergeVarProvider, [@orocrm_mailchimp.merge_var.provider]]

    orocrm_mailchimp.importexport.strategy.member_activity:
        class: %orocrm_mailchimp.importexport.strategy.member_activity.class%
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setLogger, [@oro_integration.logger.strategy]]

    orocrm_mailchimp.importexport.strategy.unsent_activity:
        class: %orocrm_mailchimp.importexport.strategy.unsent_activity.class%
        parent: oro_importexport.strategy.configurable_add_or_replace

    orocrm_mailchimp.importexport.strategy.campaign:
        class: %orocrm_mailchimp.importexport.strategy.campaign.class%
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setLogger, [@oro_integration.logger.strategy]]

    orocrm_mailchimp.importexport.strategy.static_segment:
        class: %orocrm_mailchimp.importexport.strategy.static_segment.class%
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setLogger, [@oro_integration.logger.strategy]]

    orocrm_mailchimp.importexport.strategy.static_segment_member_add_state:
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setEntityName, [%orocrm_mailchimp.entity.static_segment_member.class%]]

    orocrm_mailchimp.importexport.strategy.static_segment_member_remove_state:
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setEntityName, [%orocrm_mailchimp.entity.static_segment_member.class%]]

    orocrm_mailchimp.importexport.strategy.export_member:
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setEntityName, [%orocrm_mailchimp.entity.member.class%]]

    orocrm_mailchimp.importexport.strategy.export_static_segment:
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setEntityName, [%orocrm_mailchimp.entity.static_segment_member.class%]]

    # Import Processors
    orocrm_mailchimp.importexport.processor.import_abstract:
        parent: oro_importexport.processor.import_abstract
        abstract: true
        calls:
            - [setContextRegistry, [@oro_importexport.context_registry]]

    orocrm_mailchimp.importexport.processor.campaign:
        class: %orocrm_mailchimp.importexport.processor.import.class%
        parent: orocrm_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, [@orocrm_mailchimp.importexport.data_converter.campaign]]
            - [setStrategy, [@orocrm_mailchimp.importexport.strategy.campaign]]
            - [setEntityName, [%orocrm_mailchimp.entity.campaign.class%]]

    orocrm_mailchimp.importexport.processor.list:
        class: %orocrm_mailchimp.importexport.processor.import.class%
        parent: orocrm_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, [@orocrm_mailchimp.importexport.data_converter.list]]
            - [setStrategy, [@orocrm_mailchimp.importexport.strategy.list]]
            - [setEntityName, [%orocrm_mailchimp.entity.subscribers_list.class%]]

    orocrm_mailchimp.importexport.processor.member:
        class: %orocrm_mailchimp.importexport.processor.import.class%
        parent: orocrm_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, [@orocrm_mailchimp.importexport.data_converter.member]]
            - [setStrategy, [@orocrm_mailchimp.importexport.strategy.member]]
            - [setEntityName, [%orocrm_mailchimp.entity.member.class%]]

    orocrm_mailchimp.importexport.processor.member_activity:
        class: %orocrm_mailchimp.importexport.processor.import.class%
        parent: orocrm_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, [@orocrm_mailchimp.importexport.data_converter.member_activity]]
            - [setStrategy, [@orocrm_mailchimp.importexport.strategy.member_activity]]
            - [setEntityName, [%orocrm_mailchimp.entity.member_activity.class%]]

    orocrm_mailchimp.importexport.processor.unsent_activity:
        class: %orocrm_mailchimp.importexport.processor.import.class%
        parent: orocrm_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, [@orocrm_mailchimp.importexport.data_converter.unsent_activity]]
            - [setStrategy, [@orocrm_mailchimp.importexport.strategy.unsent_activity]]
            - [setEntityName, [%orocrm_mailchimp.entity.member_activity.class%]]

    orocrm_mailchimp.importexport.processor.template:
        class: %orocrm_mailchimp.importexport.processor.import.class%
        parent: orocrm_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, [@orocrm_mailchimp.importexport.data_converter.template]]
            - [setStrategy, [@orocrm_mailchimp.importexport.strategy.template.add_or_replace]]
            - [setEntityName, [%orocrm_mailchimp.entity.template.class%]]

    orocrm_mailchimp.importexport.processor.static_segment:
        class: %orocrm_mailchimp.importexport.processor.import.class%
        parent: orocrm_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, [@orocrm_mailchimp.importexport.data_converter.static_segment]]
            - [setStrategy, [@orocrm_mailchimp.importexport.strategy.static_segment]]
            - [setEntityName, [%orocrm_mailchimp.entity.static_segment.class%]]

    orocrm_mailchimp.importexport.processor.remove.abstract:
        class: %orocrm_mailchimp.importexport.processor.remove.class%
        abstract: true
        arguments:
            - @oro_importexport.context_registry
            - @oro_entity.doctrine_helper

    orocrm_mailchimp.importexport.processor.template.remove:
        parent: orocrm_mailchimp.importexport.processor.remove.abstract
        calls:
            - [setEntityName, [%orocrm_mailchimp.entity.template.class%]]
            - [setSearchField, ['originId']]

    orocrm_mailchimp.importexport.processor.list.remove:
        parent: orocrm_mailchimp.importexport.processor.remove.abstract
        calls:
            - [setEntityName, [%orocrm_mailchimp.entity.subscribers_list.class%]]
            - [setSearchField, ['originId']]

    orocrm_mailchimp.importexport.processor.campaign.remove:
        parent: orocrm_mailchimp.importexport.processor.remove.abstract
        calls:
            - [setEntityName, [%orocrm_mailchimp.entity.campaign.class%]]
            - [setSearchField, ['originId']]

    orocrm_mailchimp.importexport.processor.members_sync:
        class: %orocrm_mailchimp.importexport.processor.import.class%
        parent: orocrm_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, [@orocrm_mailchimp.importexport.data_converter.member_sync]]
            - [setStrategy, [@orocrm_mailchimp.importexport.strategy.member]]
            - [setEntityName, [%orocrm_mailchimp.entity.member.class%]]

    orocrm_mailchimp.importexport.processor.static_segment_member_add_state:
        class: %orocrm_mailchimp.importexport.processor.import.class%
        parent: orocrm_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, [@orocrm_mailchimp.importexport.data_converter.static_segment_member]]
            - [setStrategy, [@orocrm_mailchimp.importexport.strategy.static_segment_member_add_state]]
            - [setEntityName, [%orocrm_mailchimp.entity.static_segment_member.class%]]

    orocrm_mailchimp.importexport.processor.static_segment_member_remove_state:
        class: %orocrm_mailchimp.importexport.processor.import.class%
        parent: orocrm_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, [@orocrm_mailchimp.importexport.data_converter.static_segment_member]]
            - [setStrategy, [@orocrm_mailchimp.importexport.strategy.static_segment_member_remove_state]]

    # Export Processors
    orocrm_mailchimp.importexport.processor.export_member:
        class: %orocrm_mailchimp.importexport.processor.export_member.class%
        parent: oro_importexport.processor.export_abstract
        calls:
            - [setContextRegistry, [@oro_importexport.context_registry]]
            - [setStrategy, [@orocrm_mailchimp.importexport.strategy.export_member]]

    orocrm_mailchimp.importexport.processor.export_static_segment:
        class: %orocrm_mailchimp.importexport.processor.export_static_segment.class%
        parent: oro_importexport.processor.export_abstract
        calls:
            - [setContextRegistry, [@oro_importexport.context_registry]]
            - [setStrategy, [@orocrm_mailchimp.importexport.strategy.export_static_segment]]

    # MergeVar related services
    orocrm_mailchimp.merge_var.provider:
        class: %orocrm_mailchimp.merge_var.provider.class%

    # Service for locking processes
    orocrm_mailchimp.lock:
        class: %orocrm_mailchimp.lock.class%
        shared: true

    # Workflow actions and conditions
    orocrm_mailchimp.workflow.condition.is_locked:
        class: %orocrm_mailchimp.workflow.condition.is_locked.class%
        arguments:
            - @oro_workflow.context_accessor
            - @orocrm_mailchimp.lock
        tags:
            - { name: oro_workflow.condition, alias: is_locked }

    orocrm_mailchimp.workflow.action.lock:
        class: %orocrm_mailchimp.workflow.action.lock.class%
        arguments:
            - @oro_workflow.context_accessor
            - @orocrm_mailchimp.lock
        tags:
            - { name: oro_workflow.action, alias: lock }

    orocrm_mailchimp.workflow.action.unlock:
        class: %orocrm_mailchimp.workflow.action.unlock.class%
        arguments:
            - @oro_workflow.context_accessor
            - @orocrm_mailchimp.lock
        tags:
            - { name: oro_workflow.action, alias: unlock }

    orocrm_mailchimp.workflow.action.remove_entity:
        class: %orocrm_mailchimp.workflow.action.remove_entity.class%
        arguments:
            - @oro_workflow.context_accessor
            - @doctrine
        tags:
            - { name: oro_workflow.action, alias: remove_entity }

    orocrm_mailchimp.workflow.action.populate_integration_owner:
        class: %orocrm_mailchimp.workflow.action.populate_integration_owner.class%
        arguments:
            - @oro_workflow.context_accessor
            - @oro_integration.helper.default_owner_helper
        tags:
            - { name: oro_workflow.action, alias: populate_integration_owner }

    orocrm_mailchimp.workflow.action.assign_constant_value:
        class: %orocrm_mailchimp.workflow.action.assign_constant_value.class%
        arguments:
            - @oro_workflow.context_accessor
        tags:
            - { name: oro_workflow.action, alias: assign_constant_value }

    orocrm_mailchimp.workflow.action.abstract_marketing_list_entities:
        class: %orocrm_mailchimp.workflow.action.abstract_marketing_list_entities.class%
        astract: true
        arguments:
            - @oro_workflow.context_accessor
            - @orocrm_marketing_list.provider.contact_information_fields
            - @orocrm_marketing_list.provider.marketing_list
            - @orocrm_mailchimp.model.field_helper

    orocrm_mailchimp.workflow.action.update_email_campaign_statistics:
        class: %orocrm_mailchimp.workflow.action.update_email_campaign_statistics.class%
        parent: orocrm_mailchimp.workflow.action.abstract_marketing_list_entities
        calls:
            - [setCampaignStatisticsConnector, [@orocrm_campaign.email_campaign.statistics_connector]]
        tags:
            - { name: oro_workflow.action, alias: update_email_campaign_statistics }

    orocrm_mailchimp.workflow.action.create_marketing_list_state_item:
        parent: orocrm_mailchimp.workflow.action.abstract_marketing_list_entities
        calls:
            - [setDoctrineHelper, [@oro_entity.doctrine_helper]]
            - [setMarketingListStateItemClassName, [%orocrm_marketing_list.unsubscribed_item.class%]]

    orocrm_mailchimp.workflow.action.create_marketing_list_unsubscribed_item:
        class: %orocrm_mailchimp.workflow.action.create_marketing_list_state_item.class%
        parent: orocrm_mailchimp.workflow.action.create_marketing_list_state_item
        tags:
            - { name: oro_workflow.action, alias: create_marketing_list_unsubscribed_item }

    orocrm_mailchimp.workflow.action.create_marketing_list_removed_item:
        class: %orocrm_mailchimp.workflow.action.create_marketing_list_state_item.class%
        parent: orocrm_mailchimp.workflow.action.create_marketing_list_state_item
        tags:
            - { name: oro_workflow.action, alias: create_marketing_list_removed_item }

    orocrm_mailchimp.email_campaign.security.acl.voter.entity:
        class: %orocrm_mailchimp.email_campaign.security.acl.voter.entity.class%
        arguments:
            - @doctrine
            - @oro_entity.doctrine_helper
        tags:
            - { name: security.voter, priority: 500 }

    orocrm_mailchimp.static_segment_manager.state_manager:
        class: %orocrm_mailchimp.static_segment_manager.state_manager.class%
        arguments:
            - @oro_entity.doctrine_helper
            - %orocrm_mailchimp.entity.static_segment_member.class%

    # Iterators
    orocrm_mailchimp.iterator.static_segment:
        class: %orocrm_mailchimp.iterator.static_segment.class%
        abstract: true
        arguments:
            - @orocrm_marketing_list.provider.marketing_list
            - @orocrm_marketing_list.provider.contact_information_fields
            - @orocrm_mailchimp.model.field_helper
            - %orocrm_mailchimp.entity.member.class%

    orocrm_mailchimp.iterator.member_sync:
        class: %orocrm_mailchimp.iterator.member_sync.class%
        parent: orocrm_mailchimp.iterator.static_segment

    orocrm_mailchimp.iterator.static_segment_member_add_state:
        class: %orocrm_mailchimp.iterator.static_segment_member_add_state.class%
        parent: orocrm_mailchimp.iterator.static_segment

    orocrm_mailchimp.iterator.static_segment_member_remove_state:
        class: %orocrm_mailchimp.iterator.static_segment_member_remove_state.class%
        parent: orocrm_mailchimp.iterator.static_segment
        calls:
            - [setSegmentMemberClassName, [%orocrm_mailchimp.entity.static_segment_member.class%]]

    orocrm_mailchimp.placeholder.filter.email_campaign:
        class: %orocrm_mailchimp.placeholder.filter.email_campaign.class%
        arguments:
            - @doctrine
